

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>georasters.georasters &mdash; GeoRasters 0.5.15 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> GeoRasters
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GeoRasters</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>georasters.georasters</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for georasters.georasters</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># coding: utf-8</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">GeoRasters</span>
<span class="sd">This program defines functions that are useful for working with GIS data in Python</span>
<span class="sd">Copyright (C) 2014-2016 Ömer Özak</span>

<span class="sd">Usage:</span>

<span class="sd">import georasters as gr</span>

<span class="sd">======================================================</span>
<span class="sd">Author:  Ömer Özak, 2013--2014 (ozak at smu.edu)</span>
<span class="sd">Website: http://omerozak.com</span>
<span class="sd">GitHub:  https://github.com/ozak/</span>
<span class="sd">======================================================</span>

<span class="sd">This program is free software: you can redistribute it and/or modify</span>
<span class="sd">it under the terms of the GNU General Public License as published by</span>
<span class="sd">the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">(at your option) any later version.</span>

<span class="sd">This program is distributed in the hope that it will be useful,</span>
<span class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">GNU General Public License for more details.</span>

<span class="sd">You should have received a copy of the GNU General Public License</span>
<span class="sd">along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="k">import</span> <span class="n">gdal</span><span class="p">,</span> <span class="n">gdalnumeric</span><span class="p">,</span> <span class="n">ogr</span><span class="p">,</span> <span class="n">osr</span><span class="p">,</span> <span class="n">gdal_array</span>
<span class="kn">from</span> <span class="nn">gdalconst</span> <span class="k">import</span> <span class="n">GA_ReadOnly</span>
<span class="kn">from</span> <span class="nn">skimage.measure</span> <span class="k">import</span> <span class="n">block_reduce</span>
<span class="kn">from</span> <span class="nn">skimage.transform</span> <span class="k">import</span> <span class="n">resize</span>
<span class="kn">import</span> <span class="nn">skimage.graph</span> <span class="k">as</span> <span class="nn">graph</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">fiona.crs</span> <span class="k">import</span> <span class="n">from_string</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gp</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="k">import</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">LineString</span>
<span class="kn">from</span> <span class="nn">affine</span> <span class="k">import</span> <span class="n">Affine</span>
<span class="kn">from</span> <span class="nn">rasterstats</span> <span class="k">import</span> <span class="n">zonal_stats</span>
<span class="kn">import</span> <span class="nn">pysal</span>

<span class="c1"># Function to read the original file&#39;s projection:</span>
<div class="viewcode-block" id="get_geo_info"><a class="viewcode-back" href="../../index.html#georasters.get_geo_info">[docs]</a><span class="k">def</span> <span class="nf">get_geo_info</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Gets information from a Raster data set</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">sourceds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">GA_ReadOnly</span><span class="p">)</span>
    <span class="n">ndv</span> <span class="o">=</span> <span class="n">sourceds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">GetNoDataValue</span><span class="p">()</span>
    <span class="n">xsize</span> <span class="o">=</span> <span class="n">sourceds</span><span class="o">.</span><span class="n">RasterXSize</span>
    <span class="n">ysize</span> <span class="o">=</span> <span class="n">sourceds</span><span class="o">.</span><span class="n">RasterYSize</span>
    <span class="n">geot</span> <span class="o">=</span> <span class="n">sourceds</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
    <span class="n">projection</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
    <span class="n">projection</span><span class="o">.</span><span class="n">ImportFromWkt</span><span class="p">(</span><span class="n">sourceds</span><span class="o">.</span><span class="n">GetProjectionRef</span><span class="p">())</span>
    <span class="n">datatype</span> <span class="o">=</span> <span class="n">sourceds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">DataType</span>
    <span class="n">datatype</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDataTypeName</span><span class="p">(</span><span class="n">datatype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ndv</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">,</span> <span class="n">geot</span><span class="p">,</span> <span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span></div>

<span class="c1"># Function to map location in pixel of raster array</span>
<div class="viewcode-block" id="map_pixel"><a class="viewcode-back" href="../../index.html#georasters.map_pixel">[docs]</a><span class="k">def</span> <span class="nf">map_pixel</span><span class="p">(</span><span class="n">point_x</span><span class="p">,</span> <span class="n">point_y</span><span class="p">,</span> <span class="n">cellx</span><span class="p">,</span> <span class="n">celly</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Usage:</span>
<span class="sd">        map_pixel(xcoord, ycoord, x_cell_size, y_cell_size, xmin, ymax)</span>

<span class="sd">    where:</span>
<span class="sd">        xmin is leftmost X coordinate in system</span>

<span class="sd">        ymax is topmost Y coordinate in system</span>

<span class="sd">    Example:</span>
<span class="sd">            raster = HMISea.tif</span>

<span class="sd">            ndv, xsize, ysize, geot, projection, datatype = get_geo_info(raster)</span>

<span class="sd">            row, col = map_pixel(x,y,geot[1],geot[-1], geot[0],geot[3])</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">point_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">point_x</span><span class="p">)</span>
    <span class="n">point_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">point_y</span><span class="p">)</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">point_x</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">cellx</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">point_y</span> <span class="o">-</span> <span class="n">ymax</span><span class="p">)</span> <span class="o">/</span> <span class="n">celly</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span></div>

<div class="viewcode-block" id="map_pixel_inv"><a class="viewcode-back" href="../../index.html#georasters.map_pixel_inv">[docs]</a><span class="k">def</span> <span class="nf">map_pixel_inv</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">cellx</span><span class="p">,</span> <span class="n">celly</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Usage:</span>
<span class="sd">        map_pixel(xcoord, ycoord, x_cell_size, y_cell_size, xmin, ymax)</span>


<span class="sd">    where:</span>
<span class="sd">            xmin is leftmost X coordinate in system</span>

<span class="sd">            ymax is topmost Y coordinate in system</span>

<span class="sd">    Example:</span>
<span class="sd">            raster = HMISea.tif</span>

<span class="sd">            ndv, xsize, ysize, geot, projection, datatype = get_geo_info(raster)</span>

<span class="sd">            row, col = map_pixel(x,y,geot[1],geot[-1], geot[0],geot[3])</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">point_x</span> <span class="o">=</span> <span class="n">xmin</span><span class="o">+</span><span class="n">col</span><span class="o">*</span><span class="n">cellx</span>
    <span class="n">point_y</span> <span class="o">=</span> <span class="n">ymax</span><span class="o">+</span><span class="n">row</span><span class="o">*</span><span class="n">celly</span>
    <span class="k">return</span> <span class="n">point_x</span><span class="p">,</span> <span class="n">point_y</span></div>

<span class="c1"># Aggregate raster to higher resolution using sums</span>
<div class="viewcode-block" id="aggregate"><a class="viewcode-back" href="../../index.html#georasters.aggregate">[docs]</a><span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">ndv</span><span class="p">,</span> <span class="n">block_size</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Aggregate raster to smaller resolution, by adding cells.</span>
<span class="sd">    Usage:</span>
<span class="sd">            aggregate(raster, ndv, block_size)</span>

<span class="sd">    where:</span>
<span class="sd">            raster is a Numpy array created by importing the raster (e.g. geotiff)</span>

<span class="sd">            ndv is the NoData Value for the raster (can be read using the get_geo_info function)</span>

<span class="sd">            block_size is a duple of factors by which the raster will be shrinked</span>

<span class="sd">    Example:</span>
<span class="sd">            raster = HMISea.tif</span>

<span class="sd">            ndv, xsize, ysize, geot, projection, datatype = get_geo_info(raster)</span>

<span class="sd">            costs = load_tiff(raster)</span>

<span class="sd">            costs2=aggregate(costs, ndv, (10,10))</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">raster2</span> <span class="o">=</span> <span class="n">block_reduce</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">raster2</span></div>

<span class="c1"># Function to write a new file.</span>
<div class="viewcode-block" id="create_geotiff"><a class="viewcode-back" href="../../index.html#georasters.create_geotiff">[docs]</a><span class="k">def</span> <span class="nf">create_geotiff</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">Array</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">ndv</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">,</span> <span class="n">geot</span><span class="p">,</span> <span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Creates new geotiff from array</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datatype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">datatype</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;gdal.GDT_&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">datatype</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;gdal.GDT_&#39;</span><span class="o">+</span><span class="n">datatype</span><span class="p">)</span>
    <span class="n">newfilename</span> <span class="o">=</span> <span class="n">name</span><span class="o">+</span><span class="s1">&#39;.tif&#39;</span>
    <span class="c1"># Set nans to the original No Data Value</span>
    <span class="n">Array</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Array</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ndv</span>
    <span class="c1"># Set up the dataset</span>
    <span class="n">DataSet</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">newfilename</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">datatype</span><span class="p">)</span>
    <span class="c1"># the &#39;1&#39; is for band 1.</span>
    <span class="n">DataSet</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">geot</span><span class="p">)</span>
    <span class="n">DataSet</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">projection</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">())</span>
    <span class="c1"># Write the array</span>
    <span class="n">DataSet</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">Array</span><span class="p">)</span>
    <span class="n">DataSet</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="n">ndv</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newfilename</span></div>

<span class="c1"># Function to aggregate and align rasters</span>
<div class="viewcode-block" id="align_rasters"><a class="viewcode-back" href="../../index.html#georasters.align_rasters">[docs]</a><span class="k">def</span> <span class="nf">align_rasters</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">alignraster</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">cxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cysize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">masked</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Align two rasters so that data overlaps by geographical location</span>
<span class="sd">    Usage:</span>
<span class="sd">    (alignedraster_o, alignedraster_a, geot_a) = AlignRasters(raster, alignraster, how=np.mean)</span>

<span class="sd">    where:</span>
<span class="sd">        raster: string with location of raster to be aligned</span>

<span class="sd">        alignraster: string with location of raster to which raster will be aligned</span>

<span class="sd">        how: function used to aggregate cells (if the rasters have different sizes)</span>

<span class="sd">    It is assumed that both rasters have the same size</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ndv1</span><span class="p">,</span> <span class="n">xsize1</span><span class="p">,</span> <span class="n">ysize1</span><span class="p">,</span> <span class="n">geot1</span><span class="p">,</span> <span class="n">projection1</span><span class="p">,</span> <span class="n">datatype1</span> <span class="o">=</span> <span class="n">get_geo_info</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span>
    <span class="n">ndv2</span><span class="p">,</span> <span class="n">xsize2</span><span class="p">,</span> <span class="n">ysize2</span><span class="p">,</span> <span class="n">geot2</span><span class="p">,</span> <span class="n">projection2</span><span class="p">,</span> <span class="n">datatype2</span> <span class="o">=</span> <span class="n">get_geo_info</span><span class="p">(</span><span class="n">alignraster</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">projection1</span><span class="o">.</span><span class="n">ExportToMICoordSys</span><span class="p">()</span> <span class="o">==</span> <span class="n">projection2</span><span class="o">.</span><span class="n">ExportToMICoordSys</span><span class="p">():</span>
        <span class="n">blocksize</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">geot2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">geot1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">geot2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">geot1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
        <span class="n">mraster</span> <span class="o">=</span> <span class="n">gdalnumeric</span><span class="o">.</span><span class="n">LoadFile</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span>
        <span class="n">mraster</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">mraster</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mraster</span> <span class="o">==</span> <span class="n">ndv1</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">ndv1</span><span class="p">)</span>
        <span class="n">mmin</span> <span class="o">=</span> <span class="n">mraster</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">mraster</span> <span class="o">=</span> <span class="n">block_reduce</span><span class="p">(</span><span class="n">mraster</span><span class="p">,</span> <span class="n">blocksize</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">how</span><span class="p">)</span>
        <span class="n">araster</span> <span class="o">=</span> <span class="n">gdalnumeric</span><span class="o">.</span><span class="n">LoadFile</span><span class="p">(</span><span class="n">alignraster</span><span class="p">)</span>
        <span class="n">araster</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">araster</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">araster</span> <span class="o">==</span> <span class="n">ndv2</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">ndv2</span><span class="p">)</span>
        <span class="n">amin</span> <span class="o">=</span> <span class="n">araster</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">row3</span><span class="p">,</span> <span class="n">mcol</span> <span class="o">=</span> <span class="n">map_pixel</span><span class="p">(</span><span class="n">geot2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span><span class="n">blocksize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">geot1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">blocksize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">acol</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row3</span><span class="p">,</span> <span class="n">acol</span> <span class="o">=</span> <span class="n">map_pixel</span><span class="p">(</span><span class="n">geot1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">mcol</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
            <span class="n">arow</span><span class="p">,</span> <span class="n">col3</span> <span class="o">=</span> <span class="n">map_pixel</span><span class="p">(</span><span class="n">geot1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">mrow</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mrow</span><span class="p">,</span> <span class="n">col3</span> <span class="o">=</span> <span class="n">map_pixel</span><span class="p">(</span><span class="n">geot2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span><span class="n">blocksize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">geot1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">blocksize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">arow</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        col3,row3 = map_pixel(geot1[0], geot1[3], geot2[1],geot2[-1], geot2[0], geot2[3])</span>
<span class="sd">        col3 = max(0,col3)</span>
<span class="sd">        row3 = max(0,row3)</span>
<span class="sd">        araster = araster[row3:,col3:]</span>
<span class="sd">        col3,row3 = map_pixel(geot2[0], geot2[3], geot1[1] *blocksize[0],</span>
<span class="sd">                              geot1[-1]*blocksize[1], geot1[0], geot1[3])</span>
<span class="sd">        col3 = max(0,abs(col3))</span>
<span class="sd">        row3 = max(0,np.abs(row3))</span>
<span class="sd">        mraster = mraster[row3:,col3:]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">mraster</span> <span class="o">=</span> <span class="n">mraster</span><span class="p">[</span><span class="n">mrow</span><span class="p">:,</span> <span class="n">mcol</span><span class="p">:]</span>
        <span class="n">araster</span> <span class="o">=</span> <span class="n">araster</span><span class="p">[</span><span class="n">arow</span><span class="p">:,</span> <span class="n">acol</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">cxsize</span> <span class="ow">and</span> <span class="n">cysize</span><span class="p">:</span>
            <span class="n">araster</span> <span class="o">=</span> <span class="n">araster</span><span class="p">[:</span><span class="n">cysize</span><span class="p">,</span> <span class="p">:</span><span class="n">cxsize</span><span class="p">]</span>
            <span class="n">mraster</span> <span class="o">=</span> <span class="n">mraster</span><span class="p">[:</span><span class="n">cysize</span><span class="p">,</span> <span class="p">:</span><span class="n">cxsize</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">araster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mraster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">araster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mraster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">araster</span> <span class="o">=</span> <span class="n">araster</span><span class="p">[:</span><span class="n">rows</span><span class="p">,</span> <span class="p">:</span><span class="n">cols</span><span class="p">]</span>
            <span class="n">mraster</span> <span class="o">=</span> <span class="n">mraster</span><span class="p">[:</span><span class="n">rows</span><span class="p">,</span> <span class="p">:</span><span class="n">cols</span><span class="p">]</span>
        <span class="c1">#mraster = mraster[row3:rows+row3,col3:cols+col3]</span>
        <span class="k">if</span> <span class="n">masked</span><span class="p">:</span>
            <span class="n">mraster</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">mraster</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mraster</span> <span class="o">&lt;</span> <span class="n">mmin</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">ndv1</span><span class="p">)</span>
            <span class="n">araster</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">araster</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">araster</span> <span class="o">&lt;</span> <span class="n">amin</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">ndv2</span><span class="p">)</span>
        <span class="n">geot</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">geot1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">blocksize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">geot1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">blocksize</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">mraster</span><span class="p">,</span> <span class="n">araster</span><span class="p">,</span> <span class="n">geot</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rasters need to be in same projection&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>

<span class="c1"># Load geotif raster data</span>
<div class="viewcode-block" id="load_tiff"><a class="viewcode-back" href="../../index.html#georasters.load_tiff">[docs]</a><span class="k">def</span> <span class="nf">load_tiff</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a geotiff raster keeping ndv values using a masked array</span>

<span class="sd">    Usage:</span>
<span class="sd">            data = load_tiff(file)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ndv</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">,</span> <span class="n">geot</span><span class="p">,</span> <span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span> <span class="o">=</span> <span class="n">get_geo_info</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gdalnumeric</span><span class="o">.</span><span class="n">LoadFile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">data</span> <span class="o">==</span> <span class="n">ndv</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">ndv</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="RasterGeoTError"><a class="viewcode-back" href="../../index.html#georasters.RasterGeoTError">[docs]</a><span class="k">class</span> <span class="nc">RasterGeoTError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="RasterGeoError"><a class="viewcode-back" href="../../index.html#georasters.RasterGeoError">[docs]</a><span class="k">class</span> <span class="nc">RasterGeoError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="RasterGeoTWarning"><a class="viewcode-back" href="../../index.html#georasters.RasterGeoTWarning">[docs]</a><span class="k">class</span> <span class="nc">RasterGeoTWarning</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="c1"># GeoRaster Class</span>
<div class="viewcode-block" id="GeoRaster"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster">[docs]</a><span class="k">class</span> <span class="nc">GeoRaster</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    GeoRaster class to create and handle GIS rasters.</span>
<span class="sd">    Eash GeoRaster object is a numpy masked array + geotransfrom + nodata_value</span>

<span class="sd">    Usage:</span>
<span class="sd">        geo=GeoRaster(raster, geot, nodata_value=ndv)</span>
<span class="sd">    where</span>
<span class="sd">        raster: Numpy masked array with the raster data,</span>
<span class="sd">                which could be loaded with the load_tiff(file)</span>
<span class="sd">        geot: GDAL Geotransformation</span>
<span class="sd">        nodata_value: No data value in raster, optional</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster</span><span class="p">,</span> <span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=-</span><span class="mf">1e10</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initialize Georaster</span>
<span class="sd">        Usage:</span>
<span class="sd">            geo=GeoRaster(raster, geot, nodata_value=ndv)</span>
<span class="sd">        where</span>
<span class="sd">            raster: Numpy masked array with the raster data,</span>
<span class="sd">                    which could be loaded with from_file(file) or load_tiff(file)</span>
<span class="sd">            geot: GDAL Geotransformation</span>
<span class="sd">            nodata_value: No data value in raster, optional</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GeoRaster</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">raster</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">raster</span> <span class="o">==</span> <span class="n">nodata_value</span><span class="p">,</span>
                                             <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">geot</span> <span class="o">=</span> <span class="n">geot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span> <span class="o">=</span> <span class="n">nodata_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_cell_size</span> <span class="o">=</span> <span class="n">geot</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_cell_size</span> <span class="o">=</span> <span class="n">geot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="n">geot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">geot</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_cell_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_cell_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">projection</span> <span class="o">=</span> <span class="n">projection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="o">=</span> <span class="n">datatype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcp_cost</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gamma</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Join_Counts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Moran</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Geary</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Moran_Local</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indx</span><span class="p">):</span>
        <span class="n">rast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span>
        <span class="n">nodata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span>
        <span class="n">geot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">)</span>
        <span class="n">geot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">indx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="o">*</span><span class="n">geot</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">geot</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="n">indx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="o">*</span><span class="n">geot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">geot</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">geot</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">rast</span><span class="p">,</span> <span class="n">geot</span><span class="p">,</span> <span class="n">nodata</span><span class="p">,</span> <span class="n">proj</span><span class="p">,</span> <span class="n">datatype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">__getslice__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

<span class="c1">#    def __getattribute__(self, attr):</span>
<span class="c1">#        return eval(&#39;self.&#39;+attr)</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GeoRaster</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">raster</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">&lt;</span> <span class="n">other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">&lt;</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GeoRaster</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">raster</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">&lt;=</span> <span class="n">other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">&lt;=</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GeoRaster</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">raster</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">&gt;</span> <span class="n">other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">&gt;</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GeoRaster</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">raster</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">&gt;=</span> <span class="n">other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">&gt;=</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GeoRaster</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">raster</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">==</span> <span class="n">other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GeoRaster</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">raster</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">!=</span> <span class="n">other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">!=</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>
                         <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GeoRaster</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">geot</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RasterGeoTWarning</span><span class="p">(</span><span class="s2">&quot;Rasters do not have same geotransform. </span><span class="se">\</span>
<span class="s2">                                        If needed first create union or allign them.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">:</span>
                <span class="n">ndv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ndv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">+</span><span class="n">other</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="n">ndv</span><span class="p">,</span>
                             <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">+</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>
                             <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">+</span><span class="n">other</span><span class="o">.</span><span class="fm">__neg__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__sub__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GeoRaster</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">geot</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RasterGeoTWarning</span><span class="p">(</span><span class="s2">&quot;Rasters do not have same geotransform. </span><span class="se">\</span>
<span class="s2">                                        If needed first create union or allign them.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">:</span>
                <span class="n">ndv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ndv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">*</span><span class="n">other</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="n">ndv</span><span class="p">,</span>
                             <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">*</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>
                             <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GeoRaster</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">geot</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RasterGeoTWarning</span><span class="p">(</span><span class="s2">&quot;Rasters do not have same geotransform. </span><span class="se">\</span>
<span class="s2">                                        If needed first create union or allign them.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">:</span>
                <span class="n">ndv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ndv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">/</span><span class="n">other</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="n">ndv</span><span class="p">,</span>
                             <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">/</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>
                             <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GeoRaster</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">other</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>
                             <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">/</span><span class="n">other</span>
        <span class="n">A</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">A</span>

    <span class="k">def</span> <span class="nf">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GeoRaster</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">geot</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RasterGeoTWarning</span><span class="p">(</span><span class="s2">&quot;Rasters do not have same geotransform. </span><span class="se">\</span>
<span class="s2">                                        If needed first create union or allign them.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">:</span>
                <span class="n">ndv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ndv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">((</span><span class="n">other</span><span class="o">.</span><span class="n">raster</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span>
                             <span class="n">nodata_value</span><span class="o">=</span><span class="n">ndv</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">((</span><span class="n">other</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span>
                             <span class="n">nodata_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span>
                             <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GeoRaster</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">geot</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RasterGeoTWarning</span><span class="p">(</span><span class="s2">&quot;Rasters do not have same geotransform. </span><span class="se">\</span>
<span class="s2">                                        If needed first create union or allign them.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">:</span>
                <span class="n">ndv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ndv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">**</span><span class="n">other</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="n">ndv</span><span class="p">,</span>
                             <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">**</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>
                             <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>

<div class="viewcode-block" id="GeoRaster.copy"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns copy of itself&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>
                         <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.to_tiff"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.to_tiff">[docs]</a>    <span class="k">def</span> <span class="nf">to_tiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.to_tiff(filename)</span>

<span class="sd">        Saves GeoRaster as geotiff filename.tif with type datatype</span>

<span class="sd">        If GeoRaster does not have datatype, then it tries to assign a type.</span>
<span class="sd">        You can assign the type yourself by setting</span>
<span class="sd">         geo.datatype = &#39;gdal.GDT_&#39;+type</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="o">=</span> <span class="n">gdal_array</span><span class="o">.</span><span class="n">NumericTypeCodeToGDALTypeCode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span> <span class="o">!=-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="o">=</span> <span class="n">gdal_array</span><span class="o">.</span><span class="n">NumericTypeCodeToGDALTypeCode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">raster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="o">=</span> <span class="n">gdal_array</span><span class="o">.</span><span class="n">NumericTypeCodeToGDALTypeCode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span>
        <span class="n">create_geotiff</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s1">&#39;GTiff&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.to_pandas"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.to_pandas">[docs]</a>    <span class="k">def</span> <span class="nf">to_pandas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert GeoRaster to Pandas DataFrame, which can be easily exported to other types of files</span>
<span class="sd">        The DataFrame has the row, col, value, x, and y values for each cell</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">to_pandas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="GeoRaster.to_geopandas"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.to_geopandas">[docs]</a>    <span class="k">def</span> <span class="nf">to_geopandas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert GeoRaster to GeoPandas DataFrame, which can be easily exported to other types</span>
<span class="sd">        of files and used to do other types of operations.</span>
<span class="sd">        The DataFrame has the geometry (Polygon), row, col, value, x, and y values for each cell</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">to_geopandas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="GeoRaster.plot"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.plot()</span>

<span class="sd">        Returns plot of raster data</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="GeoRaster.union"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.union">[docs]</a>    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.union(Georaster)</span>

<span class="sd">        Returns union of GeoRaster with another one</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">union</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">])</span></div>

<div class="viewcode-block" id="GeoRaster.merge"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.merge">[docs]</a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.merge(Georaster)</span>

<span class="sd">        Returns merge of GeoRaster with another one</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">merge</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">])</span></div>

<div class="viewcode-block" id="GeoRaster.mean"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.mean">[docs]</a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.mean(axis=None, dtype=None, out=None)</span>

<span class="sd">        Returns the average of the array elements along given axis.</span>

<span class="sd">        Refer to `numpy.mean` for full documentation.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        numpy.mean : equivalent function</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.max"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.max">[docs]</a>    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.max(axis=None, out=None)</span>

<span class="sd">        Return the maximum along a given axis.</span>

<span class="sd">        Refer to `numpy.amax` for full documentation.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        numpy.amax : equivalent function</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.min"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.min">[docs]</a>    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.min(axis=None, out=None)</span>

<span class="sd">        Return the minimum along a given axis.</span>

<span class="sd">        Refer to `numpy.amin` for full documentation.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        numpy.amin : equivalent function</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.median"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.median">[docs]</a>    <span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.median(axis=None, out=None, overwrite_input=False)</span>

<span class="sd">        axis : int, optional</span>
<span class="sd">            Axis along which the medians are computed. The default (axis=None)</span>
<span class="sd">            is to compute the median along a flattened version of the array.</span>
<span class="sd">        out : ndarray, optional</span>
<span class="sd">            Alternative output array in which to place the result. It must have</span>
<span class="sd">            the same shape and buffer length as the expected output, but the</span>
<span class="sd">            type (of the output) will be cast if necessary.</span>
<span class="sd">        overwrite_input : bool, optional</span>
<span class="sd">           If True, then allow use of memory of input array (a) for</span>
<span class="sd">           calculations. The input array will be modified by the call to</span>
<span class="sd">           median. This will save memory when you do not need to preserve the</span>
<span class="sd">           contents of the input array. Treat the input as undefined, but it</span>
<span class="sd">           will probably be fully or partially sorted. Default is False. Note</span>
<span class="sd">           that, if `overwrite_input` is True and the input is not already an</span>
<span class="sd">           ndarray, an error will be raised.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.std"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.std">[docs]</a>    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.std(axis=None, dtype=None, out=None, ddof=0)</span>

<span class="sd">        Returns the standard deviation of the array elements along given axis.</span>

<span class="sd">        Refer to `numpy.std` for full documentation.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        numpy.std : equivalent function</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.argmax"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.argmax">[docs]</a>    <span class="k">def</span> <span class="nf">argmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.argmax(axis=None, out=None)</span>

<span class="sd">        Return indices of the maximum values along the given axis.</span>

<span class="sd">        Refer to `numpy.argmax` for full documentation.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        numpy.argmax : equivalent function</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.argmin"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.argmin">[docs]</a>    <span class="k">def</span> <span class="nf">argmin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.argmin(axis=None, out=None)</span>

<span class="sd">        Return indices of the minimum values along the given axis of `a`.</span>

<span class="sd">        Refer to `numpy.argmin` for detailed documentation.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        numpy.argmin : equivalent function</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.sum"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.sum">[docs]</a>    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.sum(axis=None, dtype=None, out=None)</span>

<span class="sd">        Return the sum of the array elements over the given axis.</span>

<span class="sd">        Refer to `numpy.sum` for full documentation.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        numpy.sum : equivalent function</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.prod"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.prod">[docs]</a>    <span class="k">def</span> <span class="nf">prod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.prod(axis=None, dtype=None, out=None)</span>

<span class="sd">        Return the product of the array elements over the given axis</span>

<span class="sd">        Refer to `numpy.prod` for full documentation.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        numpy.prod : equivalent function</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.var"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.var">[docs]</a>    <span class="k">def</span> <span class="nf">var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.var(axis=None, dtype=None, out=None, ddof=0)</span>

<span class="sd">        Returns the variance of the array elements, along given axis.</span>

<span class="sd">        Refer to `numpy.var` for full documentation.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        numpy.var : equivalent function</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.count"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.count">[docs]</a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.count(axis=None)</span>
<span class="sd">        Count the non-masked elements of the array along the given axis.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.clip"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.clip">[docs]</a>    <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shp</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Clip raster using shape, where shape is either a GeoPandas DataFrame, shapefile,</span>
<span class="sd">        or some other geometry format used by python-raster-stats</span>

<span class="sd">        Returns list of GeoRasters or Pandas DataFrame with GeoRasters and additional information</span>

<span class="sd">        Usage:</span>

<span class="sd">        clipped = geo.clip(shape, keep=False)</span>

<span class="sd">        where:</span>
<span class="sd">        keep: Boolean (Default False), returns Georasters and Geometry information</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">zonal_stats</span><span class="p">(</span><span class="n">shp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span> <span class="n">all_touched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                      <span class="n">raster_out</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="n">Affine</span><span class="o">.</span><span class="n">from_gdal</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">),</span>
                                      <span class="n">geojson_out</span><span class="o">=</span><span class="n">keep</span><span class="p">,))</span>
        <span class="k">if</span> <span class="n">keep</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;GeoRaster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;mini_raster_array&#39;</span><span class="p">],</span>
                                                                      <span class="n">Affine</span><span class="o">.</span><span class="n">to_gdal</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;mini_raster_affine&#39;</span><span class="p">]),</span>
                                                                      <span class="n">nodata_value</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;mini_raster_nodata&#39;</span><span class="p">],</span>
                                                                      <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span>
                                                                      <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">))</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">shp</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
            <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols</span>
                                <span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;GeoRaster&#39;</span><span class="p">]],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>
            <span class="n">df2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;GeoRaster&#39;</span><span class="p">]</span>
            <span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;id&#39;</span><span class="p">]],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">df2</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;GeoRaster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mini_raster_array</span><span class="p">,</span>
                                                           <span class="n">Affine</span><span class="o">.</span><span class="n">to_gdal</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mini_raster_affine</span><span class="p">),</span>
                                                           <span class="n">nodata_value</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">mini_raster_nodata</span><span class="p">,</span>
                                                           <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span>
                                                           <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;GeoRaster&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></div>

<div class="viewcode-block" id="GeoRaster.stats"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.stats">[docs]</a>    <span class="k">def</span> <span class="nf">stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shp</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">add_stats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raster_out</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compute raster statistics for a given geometry in shape, where shape is either</span>
<span class="sd">        a GeoPandas DataFrame, shapefile, or some other geometry format used by</span>
<span class="sd">        python-raster-stats. Runs python-raster-stats in background</span>
<span class="sd">        (additional help and info can be found there)</span>

<span class="sd">        Returns dataframe with statistics and clipped raster</span>

<span class="sd">        Usage:</span>

<span class="sd">        df = geo.stats(shape, stats=stats, add_stats=add_stats)</span>

<span class="sd">        where:</span>
<span class="sd">        raster_out: If True (Default), returns clipped Georasters</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">zonal_stats</span><span class="p">(</span><span class="n">shp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>
                                      <span class="n">all_touched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raster_out</span><span class="o">=</span><span class="n">raster_out</span><span class="p">,</span>
                                      <span class="n">affine</span><span class="o">=</span><span class="n">Affine</span><span class="o">.</span><span class="n">from_gdal</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">),</span>
                                      <span class="n">geojson_out</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span> <span class="n">add_stats</span><span class="o">=</span><span class="n">add_stats</span><span class="p">))</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;GeoRaster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;mini_raster_array&#39;</span><span class="p">],</span>
                                                                  <span class="n">Affine</span><span class="o">.</span><span class="n">to_gdal</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;mini_raster_affine&#39;</span><span class="p">]),</span>
                                                                  <span class="n">nodata_value</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;mini_raster_nodata&#39;</span><span class="p">],</span>
                                                                  <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span>
                                                                  <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">))</span>
        <span class="n">statcols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">shp</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">shp</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">+</span><span class="n">statcols</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="s1">&#39;geometry&#39;</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;mini_raster&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cols</span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;GeoRaster&#39;</span><span class="p">]],</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df2</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df2</span></div>

<div class="viewcode-block" id="GeoRaster.gini"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.gini">[docs]</a>    <span class="k">def</span> <span class="nf">gini</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        geo.gini()</span>

<span class="sd">        Return computed Gini coefficient.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">xsort</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="c1"># increasing order</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">xsort</span><span class="p">)</span>
            <span class="n">B</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">xsort</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">xsort</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">B</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="GeoRaster.flatten"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.flatten">[docs]</a>    <span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.flatten(order=&#39;C&#39;)</span>

<span class="sd">        Return a copy of the array collapsed into one dimension.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        order : {&#39;C&#39;, &#39;F&#39;, &#39;A&#39;}, optional</span>
<span class="sd">            Whether to flatten in C (row-major), Fortran (column-major) order,</span>
<span class="sd">            or preserve the C/Fortran ordering from `a`.</span>
<span class="sd">            The default is &#39;C&#39;.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.apply"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.apply(func, *args, **kwargs)</span>

<span class="sd">        Returns the value of applying function func on the raster data</span>

<span class="sd">        func: Python function</span>
<span class="sd">        *args: Arguments of function</span>
<span class="sd">        **kwargs: Additional arguments of function</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.map_pixel"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.map_pixel">[docs]</a>    <span class="k">def</span> <span class="nf">map_pixel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_x</span><span class="p">,</span> <span class="n">point_y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.map_pixel(point_x, point_y)</span>

<span class="sd">        Return value of raster in location</span>
<span class="sd">        Note: (point_x, point_y) must belong to the geographic coordinate system and</span>
<span class="sd">        the coverage of the raster</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">map_pixel</span><span class="p">(</span><span class="n">point_x</span><span class="p">,</span> <span class="n">point_y</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">x_cell_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_cell_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">RasterGeoError</span><span class="p">(</span><span class="s1">&#39;Make sure the point belongs to the raster coverage </span><span class="se">\</span>
<span class="s1">                                 and it is in the correct geographic coordinate system.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.map_pixel_location"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.map_pixel_location">[docs]</a>    <span class="k">def</span> <span class="nf">map_pixel_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_x</span><span class="p">,</span> <span class="n">point_y</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.map_pixel(point_x, point_y)</span>

<span class="sd">        Return value of raster in location</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">map_pixel</span><span class="p">(</span><span class="n">point_x</span><span class="p">,</span> <span class="n">point_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_cell_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_cell_size</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">])</span></div>

<div class="viewcode-block" id="GeoRaster.extract"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.extract">[docs]</a>    <span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_x</span><span class="p">,</span> <span class="n">point_y</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.extract(x, y, radius=r)</span>

<span class="sd">        Return subraster of raster geo around location (x,y) with radius r</span>
<span class="sd">        where (x,y) and r are in the same coordinate system as geo</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">map_pixel</span><span class="p">(</span><span class="n">point_x</span><span class="p">,</span> <span class="n">point_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_cell_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_cell_size</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">radius</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">x_cell_size</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">row2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">radius</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">y_cell_size</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">row</span><span class="o">-</span><span class="n">row2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">row</span><span class="o">+</span><span class="n">row2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> \
                        <span class="nb">max</span><span class="p">(</span><span class="n">col</span><span class="o">-</span><span class="n">col2</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span><span class="nb">min</span><span class="p">(</span><span class="n">col</span><span class="o">+</span><span class="n">col2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span>
                        <span class="n">nodata_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>\
                        <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span></div>

    <span class="c1"># Align GeoRasters</span>
<div class="viewcode-block" id="GeoRaster.align"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.align">[docs]</a>    <span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alignraster</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">cxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cysize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.align(geo2, how=np.mean)</span>

<span class="sd">        Returns both georasters aligned and with the same pixelsize</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">align_georasters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alignraster</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">how</span><span class="p">,</span> <span class="n">cxsize</span><span class="o">=</span><span class="n">cxsize</span><span class="p">,</span> <span class="n">cysize</span><span class="o">=</span><span class="n">cysize</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.aggregate"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.aggregate">[docs]</a>    <span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_size</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.aggregate(block_size)</span>

<span class="sd">        Returns copy of raster aggregated to smaller resolution, by adding cells.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">raster2</span> <span class="o">=</span> <span class="n">block_reduce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
        <span class="n">geot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span>
        <span class="n">geot</span> <span class="o">=</span> <span class="p">(</span><span class="n">geot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">block_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">geot</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">geot</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">geot</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                <span class="n">block_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">geot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">raster2</span><span class="p">,</span> <span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>\
                        <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.block_reduce"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.block_reduce">[docs]</a>    <span class="k">def</span> <span class="nf">block_reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">mean</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.block_reduce(block_size, how=func)</span>

<span class="sd">        Returns copy of raster aggregated to smaller resolution, by adding cells.</span>
<span class="sd">        Default: func=np.ma.mean</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">raster2</span> <span class="o">=</span> <span class="n">block_reduce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">how</span><span class="p">)</span>
        <span class="n">geot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span>
        <span class="n">geot</span> <span class="o">=</span> <span class="p">(</span><span class="n">geot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">block_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">geot</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">geot</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">geot</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                <span class="n">block_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">geot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">raster2</span><span class="p">,</span> <span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>\
                        <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.resize"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.resize">[docs]</a>    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">preserve_range</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.resize(new_shape, order=0, mode=&#39;constant&#39;, cval=np.nan, preserve_range=True)</span>

<span class="sd">        Returns resized georaster</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cval</span><span class="p">:</span>
            <span class="n">cval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">raster2</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                         <span class="n">cval</span><span class="o">=</span><span class="n">cval</span><span class="p">,</span> <span class="n">preserve_range</span><span class="o">=</span><span class="n">preserve_range</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
                      <span class="n">cval</span><span class="o">=</span><span class="n">cval</span><span class="p">,</span> <span class="n">preserve_range</span><span class="o">=</span><span class="n">preserve_range</span><span class="p">)</span>
        <span class="n">raster2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">raster2</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
        <span class="n">raster2</span><span class="p">[</span><span class="n">raster2</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span>
        <span class="n">raster2</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">raster2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">raster2</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">)</span>
        <span class="n">geot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">)</span>
        <span class="p">[</span><span class="n">geot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">geot</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">geot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">/</span><span class="n">block_size</span>
        <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">raster2</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">geot</span><span class="p">),</span> <span class="n">nodata_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>\
                        <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoRaster.resize_old"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.resize_old">[docs]</a>    <span class="k">def</span> <span class="nf">resize_old</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        geo.resize(new_shape, order=0, mode=&#39;constant&#39;, cval=np.nan, preserve_range=True)</span>

<span class="sd">        Returns resized georaster</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cval</span><span class="p">:</span>
            <span class="n">cval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span>
            <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">()]))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">raster2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">raster2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">raster2</span> <span class="o">=</span> <span class="n">raster2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">raster2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">raster2</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">raster2</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">cval</span><span class="p">)</span>
        <span class="n">raster2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">raster2</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">raster2</span><span class="p">),</span>
                                     <span class="n">fill_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">fill_value</span><span class="p">)</span>
        <span class="n">raster2</span> <span class="o">=</span> <span class="n">raster2</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">raster2</span><span class="p">[</span><span class="n">raster2</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span>
        <span class="n">raster2</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">raster2</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">raster2</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">)</span>
        <span class="n">geot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">)</span>
        <span class="p">[</span><span class="n">geot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">geot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">/</span><span class="n">block_size</span>
        <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">raster2</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">geot</span><span class="p">),</span> <span class="n">nodata_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>\
                        <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span></div>

    <span class="c1"># Spatial Analysis based on PySal</span>
<div class="viewcode-block" id="GeoRaster.raster_weights"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.raster_weights">[docs]</a>    <span class="k">def</span> <span class="nf">raster_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute neighbor weights for GeoRaster.</span>
<span class="sd">        See help(gr.raster_weights) for options</span>

<span class="sd">        Usage:</span>
<span class="sd">        geo.raster_weights(rook=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">raster_weights</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GeoRaster.pysal_G"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.pysal_G">[docs]</a>    <span class="k">def</span> <span class="nf">pysal_G</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute Getis and Ord’s G for GeoRaster</span>

<span class="sd">        Usage:</span>
<span class="sd">        geo.pysal_G(permutations = 1000, rook=True)</span>

<span class="sd">        arguments passed to raster_weights() and pysal.G</span>
<span class="sd">        See help(gr.raster_weights), help(pysal.G) for options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raster_weights</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rasterf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">rasterf</span> <span class="o">=</span> <span class="n">rasterf</span><span class="p">[</span><span class="n">rasterf</span><span class="o">.</span><span class="n">mask</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">G</span><span class="p">(</span><span class="n">rasterf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    <span class="k">pass</span>

<div class="viewcode-block" id="GeoRaster.pysal_Gamma"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.pysal_Gamma">[docs]</a>    <span class="k">def</span> <span class="nf">pysal_Gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute Gamma Index of Spatial Autocorrelation for GeoRaster</span>

<span class="sd">        Usage:</span>
<span class="sd">        geo.pysal_Gamma(permutations = 1000, rook=True, operation=&#39;c&#39;)</span>

<span class="sd">        arguments passed to raster_weights() and pysal.Gamma</span>
<span class="sd">        See help(gr.raster_weights), help(pysal.Gamma) for options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raster_weights</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rasterf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">rasterf</span> <span class="o">=</span> <span class="n">rasterf</span><span class="p">[</span><span class="n">rasterf</span><span class="o">.</span><span class="n">mask</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Gamma</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">Gamma</span><span class="p">(</span><span class="n">rasterf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    <span class="k">pass</span>

<div class="viewcode-block" id="GeoRaster.pysal_Join_Counts"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.pysal_Join_Counts">[docs]</a>    <span class="k">def</span> <span class="nf">pysal_Join_Counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute join count statistics for GeoRaster</span>

<span class="sd">        Usage:</span>
<span class="sd">        geo.pysal_Join_Counts(permutations = 1000, rook=True)</span>

<span class="sd">        arguments passed to raster_weights() and pysal.Join_Counts</span>
<span class="sd">        See help(gr.raster_weights), help(pysal.Join_Counts) for options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raster_weights</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rasterf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">rasterf</span> <span class="o">=</span> <span class="n">rasterf</span><span class="p">[</span><span class="n">rasterf</span><span class="o">.</span><span class="n">mask</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Join_Counts</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">Join_Counts</span><span class="p">(</span><span class="n">rasterf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    <span class="k">pass</span>

<div class="viewcode-block" id="GeoRaster.pysal_Moran"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.pysal_Moran">[docs]</a>    <span class="k">def</span> <span class="nf">pysal_Moran</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute Moran&#39;s I measure of global spatial autocorrelation for GeoRaster</span>

<span class="sd">        Usage:</span>
<span class="sd">        geo.pysal_Moran(permutations = 1000, rook=True)</span>

<span class="sd">        arguments passed to raster_weights() and pysal.Moran</span>
<span class="sd">        See help(gr.raster_weights), help(pysal.Moran) for options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raster_weights</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rasterf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">rasterf</span> <span class="o">=</span> <span class="n">rasterf</span><span class="p">[</span><span class="n">rasterf</span><span class="o">.</span><span class="n">mask</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Moran</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">Moran</span><span class="p">(</span><span class="n">rasterf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    <span class="k">pass</span>

<div class="viewcode-block" id="GeoRaster.pysal_Geary"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.pysal_Geary">[docs]</a>    <span class="k">def</span> <span class="nf">pysal_Geary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute Geary’s C for GeoRaster</span>

<span class="sd">        Usage:</span>
<span class="sd">        geo.pysal_C(permutations = 1000, rook=True)</span>

<span class="sd">        arguments passed to raster_weights() and pysal.Geary</span>
<span class="sd">        See help(gr.raster_weights), help(pysal.Geary) for options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raster_weights</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rasterf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">rasterf</span> <span class="o">=</span> <span class="n">rasterf</span><span class="p">[</span><span class="n">rasterf</span><span class="o">.</span><span class="n">mask</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Geary</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">Geary</span><span class="p">(</span><span class="n">rasterf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    <span class="k">pass</span>

<div class="viewcode-block" id="GeoRaster.pysal_Moran_Local"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.pysal_Moran_Local">[docs]</a>    <span class="k">def</span> <span class="nf">pysal_Moran_Local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute Local Moran&#39;s I measure of local spatial autocorrelation for GeoRaster</span>

<span class="sd">        Usage:</span>
<span class="sd">        geo.pysal_Moran_Local(permutations = 1000, rook=True)</span>

<span class="sd">        arguments passed to raster_weights() and pysal.Moran_Local</span>
<span class="sd">        See help(gr.raster_weights), help(pysal.Moran_Local) for options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raster_weights</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rasterf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">rasterf</span> <span class="o">=</span> <span class="n">rasterf</span><span class="p">[</span><span class="n">rasterf</span><span class="o">.</span><span class="n">mask</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Moran_Local</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">Moran_Local</span><span class="p">(</span><span class="n">rasterf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Moran_Local</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Moran_Local</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Moran_Local</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span>
                 <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Moran_Local</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Moran_Local</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_vector</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Moran_Local</span><span class="p">,</span> <span class="n">i</span><span class="p">)))</span></div>
    <span class="k">pass</span>

<div class="viewcode-block" id="GeoRaster.pysal_G_Local"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.pysal_G_Local">[docs]</a>    <span class="k">def</span> <span class="nf">pysal_G_Local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">star</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute Local G or G* measures of local spatial autocorrelation for GeoRaster</span>

<span class="sd">        Usage:</span>
<span class="sd">        geo.pysal_Moran(permutations = 1000, rook=True)</span>

<span class="sd">        arguments passed to raster_weights() and pysal.G_Local</span>
<span class="sd">        See help(gr.raster_weights), help(pysal.G_Local) for options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">raster_weights</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">rasterf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">rasterf</span> <span class="o">=</span> <span class="n">rasterf</span><span class="p">[</span><span class="n">rasterf</span><span class="o">.</span><span class="n">mask</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G_Local</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">G_Local</span><span class="p">(</span><span class="n">rasterf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G_Local</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_Local</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_Local</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span>
                 <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_Local</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_Local</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_vector</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G_Local</span><span class="p">,</span> <span class="n">i</span><span class="p">)))</span></div>
    <span class="k">pass</span>

<div class="viewcode-block" id="GeoRaster.map_vector"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.map_vector">[docs]</a>    <span class="k">def</span> <span class="nf">map_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kvars</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create new GeoRaster, which has its data replaced by x</span>
<span class="sd">        Useful to map output of PySal analyses, e.g. spatial autocorrelation values, etc.</span>

<span class="sd">        Usage: raster2 = map_vector(x, raster)</span>
<span class="sd">        where</span>
<span class="sd">            raster: GeoRaster</span>
<span class="sd">            x: Numpy array of data with same length as non-missing values in raster,</span>
<span class="sd">               i.e., len(x) == np.sum(raster.mask==False)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">y</span><span class="o">.</span><span class="n">raster</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">y</span></div>

    <span class="c1"># Setup Graph for distance computations and provide distance functions</span>
<div class="viewcode-block" id="GeoRaster.mcp"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.mcp">[docs]</a>    <span class="k">def</span> <span class="nf">mcp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup MCP_Geometric object from skimage for optimal travel time computations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create Cost surface to work on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mcp_cost</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">MCP_Geometric</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    <span class="k">pass</span>

    <span class="c1"># Determine minimum travel cost to each location</span>
<div class="viewcode-block" id="GeoRaster.distance"><a class="viewcode-back" href="../../index.html#georasters.GeoRaster.distance">[docs]</a>    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">destinations</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">isolation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">export_raster</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">export_shape</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">routes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute cost distance measured from each start point to all end points.</span>
<span class="sd">        The function returns the distances between the start point and the end</span>
<span class="sd">        points as a Pandas dataframe. Additionally, for each start point it computes</span>
<span class="sd">        the level of isolation, i.e. its average travel distance to all other locations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_points</span> <span class="o">=</span> <span class="n">sources</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">end_points</span> <span class="o">=</span> <span class="n">destinations</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_points</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_points</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Sources has to be a (Geo)Pandas Data Frame Object.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_points</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span>
            <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end_points</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Destinations has to be a (Geo)Pandas Data Frame Object.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_cost</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mcp</span><span class="p">()</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">start_points</span><span class="p">[</span><span class="s1">&#39;row&#39;</span><span class="p">],</span> <span class="n">start_points</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_pixel_location</span><span class="p">(</span><span class="n">start_points</span><span class="p">[</span><span class="n">x</span><span class="p">],</span>
                                                                           <span class="n">start_points</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
        <span class="n">end_points</span><span class="p">[</span><span class="s1">&#39;row&#39;</span><span class="p">],</span> <span class="n">end_points</span><span class="p">[</span><span class="s1">&#39;col&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_pixel_location</span><span class="p">(</span><span class="n">end_points</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">end_points</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
        <span class="n">start_points</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="n">end_points</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_points</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="n">start_points</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">start_points</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">cumulative_costs</span><span class="p">,</span> <span class="n">traceback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_cost</span><span class="o">.</span><span class="n">find_costs</span><span class="p">([[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">row</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">col</span><span class="p">]])</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">cumulative_costs</span><span class="p">[</span><span class="n">end_points</span><span class="o">.</span><span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">end_points</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">values</span><span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="mi">7</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span>
            <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">dist</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                                    <span class="n">end_points</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">],</span> <span class="n">dist</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span>
                                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ID1&#39;</span><span class="p">,</span> <span class="s1">&#39;ID2&#39;</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">])</span>
            <span class="c1"># Keep only locations that are accessible</span>
            <span class="n">df2</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">isolation</span><span class="p">:</span>
                <span class="n">grisolation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">cumulative_costs</span><span class="p">,</span>
                                    <span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">cumulative_costs</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                                    <span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="mi">7</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span>
                <span class="n">start_points</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Iso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grisolation</span>
            <span class="k">if</span> <span class="n">export_raster</span><span class="p">:</span>
                <span class="n">cumulative_costs</span> <span class="o">=</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">cumulative_costs</span><span class="p">,</span>
                                                                <span class="n">mask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span>
                                                                                   <span class="n">cumulative_costs</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span>
                                                                <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>
                                             <span class="n">projection</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
                <span class="n">cumulative_costs</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">cumulative_costs</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative_costs</span><span class="o">.</span><span class="n">nodata_value</span>
                <span class="n">cumulative_costs</span><span class="o">.</span><span class="n">to_tiff</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;ID&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">df2</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">export_shape</span><span class="p">:</span>
                    <span class="n">routes</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">routes</span><span class="p">:</span>
                    <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;ID2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">mcp_cost</span><span class="o">.</span><span class="n">traceback</span><span class="p">(</span><span class="n">end_points</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">end_points</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="p">][[</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="s1">&#39;col&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">map_pixel_inv</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">geot</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span>
                    <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">LineString</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
                                                         <span class="k">else</span> <span class="n">LineString</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
                    <span class="n">df2</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">cea</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">isolation</span><span class="p">:</span>
                    <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;Iso&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grisolation</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grdist</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">grdist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grdist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df2</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">routes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grdist</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grdist</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">cea</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">export_shape</span><span class="p">:</span>
            <span class="n">start_pointscols</span> <span class="o">=</span> <span class="n">sources</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
            <span class="n">end_pointscols</span> <span class="o">=</span> <span class="n">destinations</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
            <span class="k">if</span> <span class="s1">&#39;geometry&#39;</span> <span class="ow">in</span> <span class="n">end_pointscols</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grdist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grdist</span><span class="p">,</span> <span class="n">end_points</span><span class="p">[[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">end_pointscols</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;ID2&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grdist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grdist</span><span class="p">,</span> <span class="n">end_points</span><span class="p">[[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">end_pointscols</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;ID2&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;geometry&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pointscols</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grdist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grdist</span><span class="p">,</span> <span class="n">start_points</span><span class="p">[[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">start_pointscols</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;ID1&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                             <span class="n">suffixes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_2&#39;</span><span class="p">,</span> <span class="s1">&#39;_1&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grdist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grdist</span><span class="p">,</span> <span class="n">start_points</span><span class="p">[[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">start_pointscols</span><span class="o">.</span><span class="n">tolist</span><span class="p">()],</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;ID1&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                             <span class="n">suffixes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;_2&#39;</span><span class="p">,</span> <span class="s1">&#39;_1&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grdist</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grdist</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">cea</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grdist</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s1">&#39;routes.shp&#39;</span><span class="p">)</span></div>
    <span class="k">pass</span></div>

<span class="c1">##########################################</span>
<span class="c1"># Useful functions defined on GeoRasters</span>
<span class="c1">##########################################</span>

<span class="c1"># Union of rasters</span>
<div class="viewcode-block" id="union"><a class="viewcode-back" href="../../index.html#georasters.union">[docs]</a><span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="n">rasters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Union of rasters</span>

<span class="sd">    Usage:</span>
<span class="sd">        union(rasters)</span>
<span class="sd">    where:</span>
<span class="sd">        rasters is a list of GeoRaster objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_cell_size</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">x_cell_size</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rasters</span><span class="p">)</span> \
       <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y_cell_size</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">y_cell_size</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rasters</span><span class="p">)</span>\
       <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">ExportToProj4</span><span class="p">()</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">ExportToProj4</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rasters</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nodata_value</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">nodata_value</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rasters</span><span class="p">):</span>
            <span class="n">ndv</span> <span class="o">=</span> <span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nodata_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ndv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">ndv</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ndv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">datatype</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rasters</span><span class="p">):</span>
            <span class="n">datatype</span> <span class="o">=</span> <span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">datatype</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">datatype</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">projection</span> <span class="o">=</span> <span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">projection</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">xmin</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">])</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">xmax</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">])</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">ymin</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">])</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">ymax</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">])</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">latmax</span><span class="o">-</span><span class="n">latmin</span><span class="p">)</span><span class="o">/</span><span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y_cell_size</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">lonmax</span><span class="o">-</span><span class="n">lonmin</span><span class="p">)</span><span class="o">/</span><span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_cell_size</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">ndv</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">outmask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">:</span>
            <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="o">=</span> <span class="n">map_pixel</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_cell_size</span><span class="p">,</span> <span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y_cell_size</span><span class="p">,</span> <span class="n">lonmin</span><span class="p">,</span> <span class="n">latmax</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="n">row</span><span class="p">:</span><span class="n">row</span><span class="o">+</span><span class="n">i</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">:</span><span class="n">col</span><span class="o">+</span><span class="n">i</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="n">i</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>\
                                                         <span class="n">out</span><span class="p">[</span><span class="n">row</span><span class="p">:</span><span class="n">row</span><span class="o">+</span><span class="n">i</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">:</span><span class="n">col</span><span class="o">+</span><span class="n">i</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">outmask</span><span class="p">[</span><span class="n">row</span><span class="p">:</span><span class="n">row</span><span class="o">+</span><span class="n">i</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">:</span><span class="n">col</span><span class="o">+</span><span class="n">i</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>\
                                                         <span class="n">outmask</span><span class="p">[</span><span class="n">row</span><span class="p">:</span><span class="n">row</span><span class="o">+</span><span class="n">i</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">:</span><span class="n">col</span><span class="o">+</span><span class="n">i</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">outmask</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">ndv</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="p">(</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x_cell_size</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">latmax</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">rasters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y_cell_size</span><span class="p">),</span> <span class="n">nodata_value</span><span class="o">=</span><span class="n">ndv</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">RasterGeoError</span><span class="p">(</span><span class="s1">&#39;Rasters need to have same pixel sizes. Use the aggregate or dissolve functions to generate correct GeoRasters&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="merge"><a class="viewcode-back" href="../../index.html#georasters.merge">[docs]</a><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">rasters</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merges GeoRasters, same as union</span>
<span class="sd">    Usage:</span>
<span class="sd">        merge(rasters)</span>
<span class="sd">    where</span>
<span class="sd">        rasters is a list of GeoRaster objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">union</span><span class="p">(</span><span class="n">rasters</span><span class="p">)</span></div>

<span class="c1"># Load data into a GeoRaster from file</span>
<div class="viewcode-block" id="from_file"><a class="viewcode-back" href="../../index.html#georasters.from_file">[docs]</a><span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a GeoRaster object from a file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ndv</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">,</span> <span class="n">geot</span><span class="p">,</span> <span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span> <span class="o">=</span> <span class="n">get_geo_info</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gdalnumeric</span><span class="o">.</span><span class="n">LoadFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">data</span> <span class="o">==</span> <span class="n">ndv</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">ndv</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="n">ndv</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span></div>

<span class="c1"># Convert Pandas DataFrame to raster</span>
<div class="viewcode-block" id="from_pandas"><a class="viewcode-back" href="../../index.html#georasters.from_pandas">[docs]</a><span class="k">def</span> <span class="nf">from_pandas</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">cellx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">celly</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">geot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a GeoRaster from a Pandas DataFrame. Useful to plot or export data to rasters.</span>
<span class="sd">    Usage:</span>
<span class="sd">        raster = from_pandas(df, value=&#39;value&#39;, x=&#39;x&#39;, y=&#39;y&#39;, cellx= cellx, celly=celly,</span>
<span class="sd">                             xmin=xmin, ymax=ymax, geot=geot, nodata_value=ndv,</span>
<span class="sd">                             projection=projection, datatype=datatype)</span>

<span class="sd">    Although it does not require all the inputs, it is highly recommended to include</span>
<span class="sd">    the geographical information, so that the GeoRaster is properly constructed. As usual,</span>
<span class="sd">    the information can be added afterwards directly to the GeoRaster.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cellx</span><span class="p">:</span>
        <span class="n">cellx</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="n">x</span><span class="p">]</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">celly</span><span class="p">:</span>
        <span class="n">celly</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="n">y</span><span class="p">]</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">xmin</span><span class="p">:</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ymax</span><span class="p">:</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">map_pixel</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">cellx</span><span class="p">,</span> <span class="n">celly</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
    <span class="n">dfout</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">value</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">])</span>
    <span class="n">dfout</span> <span class="o">=</span> <span class="n">dfout</span> <span class="o">=</span> <span class="n">dfout</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;row&quot;</span><span class="p">,</span><span class="s2">&quot;col&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="k">if</span> <span class="n">nodata_value</span><span class="p">:</span>
        <span class="n">dfout</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dfout</span><span class="p">)]</span> <span class="o">=</span> <span class="n">nodata_value</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">nodata_value</span><span class="p">:</span>
        <span class="n">nodata_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">geot</span><span class="p">:</span>
        <span class="n">geot</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">cellx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">celly</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">dfout</span><span class="p">,</span> <span class="n">geot</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="n">nodata_value</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span></div>

<span class="c1"># GDAL conversion types</span>
<span class="n">NP2GDAL_CONVERSION</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;uint8&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;int8&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;uint16&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;int16&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;uint32&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;int32&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;float32&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="s2">&quot;float64&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="s2">&quot;complex64&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;complex128&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Align GeoRasters</span>
<div class="viewcode-block" id="align_georasters"><a class="viewcode-back" href="../../index.html#georasters.align_georasters">[docs]</a><span class="k">def</span> <span class="nf">align_georasters</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">alignraster</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">cxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cysize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Align two rasters so that data overlaps by geographical location</span>
<span class="sd">    Usage: (alignedraster_o, alignedraster_a) = AlignRasters(raster, alignraster, how=np.mean)</span>
<span class="sd">    where</span>
<span class="sd">        raster: string with location of raster to be aligned</span>
<span class="sd">        alignraster: string with location of raster to which raster will be aligned</span>
<span class="sd">        how: function used to aggregate cells (if the rasters have different sizes)</span>
<span class="sd">    It is assumed that both rasters have the same size</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="p">(</span><span class="n">ndv1</span><span class="p">,</span> <span class="n">xsize1</span><span class="p">,</span> <span class="n">ysize1</span><span class="p">,</span> <span class="n">geot1</span><span class="p">,</span> <span class="n">projection1</span><span class="p">,</span> <span class="n">datatype1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">raster</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span> <span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                             <span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">raster</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span>
                                                             <span class="n">raster</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span> <span class="n">raster</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
    <span class="p">(</span><span class="n">ndv2</span><span class="p">,</span> <span class="n">xsize2</span><span class="p">,</span> <span class="n">ysize2</span><span class="p">,</span> <span class="n">geot2</span><span class="p">,</span> <span class="n">projection2</span><span class="p">,</span> <span class="n">datatype2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">alignraster</span><span class="o">.</span><span class="n">nodata_value</span><span class="p">,</span>
                                                             <span class="n">alignraster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                             <span class="n">alignraster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                             <span class="n">alignraster</span><span class="o">.</span><span class="n">geot</span><span class="p">,</span>
                                                             <span class="n">alignraster</span><span class="o">.</span><span class="n">projection</span><span class="p">,</span>
                                                             <span class="n">alignraster</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">projection1</span><span class="o">.</span><span class="n">ExportToMICoordSys</span><span class="p">()</span> <span class="o">==</span> <span class="n">projection2</span><span class="o">.</span><span class="n">ExportToMICoordSys</span><span class="p">():</span>
        <span class="n">blocksize</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">geot2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">geot1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">geot2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">geot1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">))</span>
        <span class="n">mraster</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">raster</span>
        <span class="n">mmin</span> <span class="o">=</span> <span class="n">mraster</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">block_reduce</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">mraster</span> <span class="o">=</span> <span class="n">block_reduce</span><span class="p">(</span><span class="n">mraster</span><span class="p">,</span> <span class="n">blocksize</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">how</span><span class="p">)</span>
        <span class="n">blocksize</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">geot1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">geot2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">geot1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">geot2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">))</span>
        <span class="n">araster</span> <span class="o">=</span> <span class="n">alignraster</span><span class="o">.</span><span class="n">raster</span>
        <span class="n">amin</span> <span class="o">=</span> <span class="n">araster</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">block_reduce</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">araster</span> <span class="o">=</span> <span class="n">block_reduce</span><span class="p">(</span><span class="n">araster</span><span class="p">,</span> <span class="n">blocksize</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">how</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">row3</span><span class="p">,</span> <span class="n">mcol</span> <span class="o">=</span> <span class="n">map_pixel</span><span class="p">(</span><span class="n">geot2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span><span class="n">blocksize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">geot1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">blocksize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">acol</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row3</span><span class="p">,</span> <span class="n">acol</span> <span class="o">=</span> <span class="n">map_pixel</span><span class="p">(</span><span class="n">geot1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">mcol</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
            <span class="n">arow</span><span class="p">,</span> <span class="n">col3</span> <span class="o">=</span> <span class="n">map_pixel</span><span class="p">(</span><span class="n">geot1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">mrow</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mrow</span><span class="p">,</span> <span class="n">col3</span> <span class="o">=</span> <span class="n">map_pixel</span><span class="p">(</span><span class="n">geot2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span><span class="n">blocksize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">geot1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">blocksize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">arow</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">mraster</span> <span class="o">=</span> <span class="n">mraster</span><span class="p">[</span><span class="n">mrow</span><span class="p">:,</span> <span class="n">mcol</span><span class="p">:]</span>
        <span class="n">araster</span> <span class="o">=</span> <span class="n">araster</span><span class="p">[</span><span class="n">arow</span><span class="p">:,</span> <span class="n">acol</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">cxsize</span> <span class="ow">and</span> <span class="n">cysize</span><span class="p">:</span>
            <span class="n">araster</span> <span class="o">=</span> <span class="n">araster</span><span class="p">[:</span><span class="n">cysize</span><span class="p">,</span> <span class="p">:</span><span class="n">cxsize</span><span class="p">]</span>
            <span class="n">mraster</span> <span class="o">=</span> <span class="n">mraster</span><span class="p">[:</span><span class="n">cysize</span><span class="p">,</span> <span class="p">:</span><span class="n">cxsize</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">araster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mraster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">araster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mraster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">araster</span> <span class="o">=</span> <span class="n">araster</span><span class="p">[:</span><span class="n">rows</span><span class="p">,</span> <span class="p">:</span><span class="n">cols</span><span class="p">]</span>
            <span class="n">mraster</span> <span class="o">=</span> <span class="n">mraster</span><span class="p">[:</span><span class="n">rows</span><span class="p">,</span> <span class="p">:</span><span class="n">cols</span><span class="p">]</span>
        <span class="n">mraster</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">mraster</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mraster</span> <span class="o">&lt;</span> <span class="n">mmin</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">ndv1</span><span class="p">)</span>
        <span class="n">araster</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">araster</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">araster</span> <span class="o">&lt;</span> <span class="n">amin</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">ndv2</span><span class="p">)</span>
        <span class="n">geot</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">geot1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">blocksize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">min</span><span class="p">(</span><span class="n">geot1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">geot2</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                <span class="n">geot1</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">geot1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">blocksize</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">mraster</span> <span class="o">=</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">mraster</span><span class="p">,</span> <span class="n">geot</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection1</span><span class="p">,</span>
                            <span class="n">nodata_value</span><span class="o">=</span><span class="n">ndv1</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="n">datatype1</span><span class="p">)</span>
        <span class="n">araster</span> <span class="o">=</span> <span class="n">GeoRaster</span><span class="p">(</span><span class="n">araster</span><span class="p">,</span> <span class="n">geot</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection2</span><span class="p">,</span>
                            <span class="n">nodata_value</span><span class="o">=</span><span class="n">ndv2</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="n">datatype2</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">mraster</span><span class="p">,</span> <span class="n">araster</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rasters need to be in same projection&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></div>

<span class="c1"># Test if two GeoRasters are in same geot and have same projection</span>
<span class="k">def</span> <span class="nf">is_geovalid</span><span class="p">(</span><span class="n">grasterlist</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">,</span><span class="n">grasterlist</span><span class="p">,</span>
                  <span class="p">[</span><span class="n">GeoRaster</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grasterlist</span><span class="p">))]))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">grasterlist</span><span class="p">):</span>
        <span class="n">graster0</span> <span class="o">=</span> <span class="n">grasterlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">grasterlist</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="n">grasterlist</span> <span class="o">=</span> <span class="n">grasterlist</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">graster1</span> <span class="o">=</span> <span class="n">grasterlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">graster1</span><span class="o">.</span><span class="n">geot</span> <span class="o">==</span> <span class="n">graster0</span><span class="o">.</span><span class="n">geot</span> <span class="ow">and</span>
                <span class="n">graster1</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">ExportToPrettyWkt</span><span class="p">()</span> <span class="o">==</span> <span class="n">graster0</span><span class="o">.</span><span class="n">ExportToPrettyWkt</span><span class="p">()):</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">RasterGeoTError</span><span class="p">(</span><span class="s2">&quot;Rasters must have same geotransform and projection.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">RasterGeoTError</span><span class="p">(</span><span class="s2">&quot;List must contain only GeoRasters.&quot;</span><span class="p">)</span>

<span class="c1"># Convert GeoRaster to Pandas DataFrame, which can be easily exported to other types of files</span>
<span class="c1"># Function to</span>
<div class="viewcode-block" id="to_pandas"><a class="viewcode-back" href="../../index.html#georasters.to_pandas">[docs]</a><span class="k">def</span> <span class="nf">to_pandas</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert GeoRaster to Pandas DataFrame, which can be easily exported to other types of files</span>
<span class="sd">    The DataFrame has the row, col, value, x, and y values for each cell</span>
<span class="sd">    Usage:</span>
<span class="sd">        df = gr.to_pandas(raster)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">raster</span><span class="o">.</span><span class="n">raster</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">]</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">raster</span><span class="o">.</span><span class="n">geot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">*</span><span class="n">raster</span><span class="o">.</span><span class="n">geot</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">row</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">raster</span><span class="o">.</span><span class="n">geot</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">*</span><span class="n">raster</span><span class="o">.</span><span class="n">geot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">df</span></div>

<span class="c1"># Convert GeoRaster to GeoPandas</span>
<span class="k">def</span> <span class="nf">squares</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">georaster</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="n">row</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="n">georaster</span><span class="o">.</span><span class="n">x_cell_size</span><span class="p">,</span><span class="n">row</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">x</span><span class="o">+</span><span class="n">georaster</span><span class="o">.</span><span class="n">x_cell_size</span><span class="p">,</span><span class="n">row</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="n">georaster</span><span class="o">.</span><span class="n">y_cell_size</span><span class="p">),</span>
                        <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">row</span><span class="o">.</span><span class="n">y</span><span class="o">+</span><span class="n">georaster</span><span class="o">.</span><span class="n">y_cell_size</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">geometry</span>

<div class="viewcode-block" id="to_geopandas"><a class="viewcode-back" href="../../index.html#georasters.to_geopandas">[docs]</a><span class="k">def</span> <span class="nf">to_geopandas</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert GeoRaster to GeoPandas DataFrame, which can be easily exported to other types of files</span>
<span class="sd">    and used to do other types of operations.</span>
<span class="sd">    The DataFrame has the geometry (Polygon), row, col, value, x, and y values for each cell</span>
<span class="sd">    Usage:</span>
<span class="sd">        df = gr.to_geopandas(raster)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">to_pandas</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">squares</span><span class="p">,</span> <span class="n">georaster</span><span class="o">=</span><span class="n">raster</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">from_string</span><span class="p">(</span><span class="n">raster</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">ExportToProj4</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">df</span></div>

<div class="viewcode-block" id="raster_weights"><a class="viewcode-back" href="../../index.html#georasters.raster_weights">[docs]</a><span class="k">def</span> <span class="nf">raster_weights</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">rook</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct PySal weights for rasters</span>
<span class="sd">    It drops weights for all cells that have no data or are Inf/NaN</span>
<span class="sd">    Usage:</span>

<span class="sd">    w = raster_weights(raster, rook=False, transform=&#39;r&#39;, **kwargs)</span>

<span class="sd">    where</span>
<span class="sd">        raster: (Masked) Numpy array for which weights are to be constructed</span>
<span class="sd">        rook: Boolean, type of contiguity. Default is queen. For rook, rook = True</span>
<span class="sd">        **kwargs are defined by and passed to pysal.lat2W.</span>
<span class="sd">        See help(pysal.lat2W)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rasterf</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">raster</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">lat2W</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">,</span> <span class="n">rook</span><span class="o">=</span><span class="n">rook</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Identify missing/no data</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rasterf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
        <span class="n">miss</span> <span class="o">=</span> <span class="n">rasterf</span><span class="o">.</span><span class="n">mask</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">miss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">rasterf</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">rasterf</span><span class="p">))</span>
    <span class="n">missn</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">miss</span><span class="p">))[</span><span class="n">miss</span><span class="p">])</span>

    <span class="n">cneighbors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">w</span><span class="o">.</span><span class="n">neighbors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">missn</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">missn</span><span class="p">))</span>
            <span class="n">cneighbors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">W</span><span class="p">(</span><span class="n">cneighbors</span><span class="p">)</span>
    <span class="n">w</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span>
    <span class="k">return</span> <span class="n">w</span></div>

<div class="viewcode-block" id="map_vector"><a class="viewcode-back" href="../../index.html#georasters.map_vector">[docs]</a><span class="k">def</span> <span class="nf">map_vector</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">raster</span><span class="p">,</span> <span class="o">**</span><span class="n">kvars</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create new GeoRaster, which has its data replaced by x</span>
<span class="sd">    Useful to map output of PySal analyses, e.g. spatial autocorrelation values, etc.</span>

<span class="sd">    Usage: raster2 = map_vector(x, raster)</span>
<span class="sd">    where</span>
<span class="sd">        raster: GeoRaster</span>
<span class="sd">        x: Numpy array of data with same length as non-missing values in raster,</span>
<span class="sd">           i.e., len(x) == np.sum(raster.mask==False)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">y</span><span class="o">.</span><span class="n">raster</span><span class="p">[</span><span class="n">y</span><span class="o">.</span><span class="n">raster</span><span class="o">.</span><span class="n">mask</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">y</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Ömer Özak

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>